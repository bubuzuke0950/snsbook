# 6. 瞬目反射条件づけのシミュレーション

## ファイル一覧
- `main.c`: main関数
- `gr.c`: 顆粒細胞のモデル
- `gr.h`: 顆粒細胞のモデル (ヘッダファイル)
- `go.c`: ゴルジ細胞のモデル
- `go.h`: ゴルジ細胞のモデル (ヘッダファイル)
- `pc.c`: プルキンエ細胞のモデル
- `pc.h`: プルキンエ細胞のモデル (ヘッダファイル)
- `conn.c`: 顆粒細胞--ゴルジ細胞間の結合を設定する関数
- `conn.h`: 顆粒細胞--ゴルジ細胞間の結合を設定する関数 (ヘッダファイル)
- `param.h`: シミュレーションの各種パラメータ
- `psth.rb`: PSTH (図6.5) を計算するためのRubyスクリプト
- `Makefile`: Makefile
- `README-ja.md`: 日本語の説明 (このファイル)

## コードの説明
このコードは、Yamazaki & Nagao (2012), Yamazaki & Tanaka (2007) を改変して作成した。ともにオープンアクセス
でPDFをダウンロードできるので、詳細はそちらを参照していただきたい。Yamazaki & Tanaka (2007)が瞬目反射条件づけ
のシミュレーションを行っている。Yamazaki & Nagao (2012)は、同じメカニズムで視機性眼球運動の適応を説明しよう
としたものである。
[Yamazaki & Nagao (2012) A Computational Mechanism for Unified Gain and Timing Control in the Cerebellum. PLoS ONE 7(3): e33319.](https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0033319)
[Yamazaki & Tanaka (2007) A spiking network model for passage-of-time representation in the cerebellum. European Journal of Neuroscience 26(8): 2279--2292.](https://onlinelibrary.wiley.com/doi/10.1111/j.1460-9568.2007.05837.x)

基本的なダイナミクスは以下の通りである。まず顆粒細胞--ゴルジ細胞の抑制性のリカレントネットワークによって、
顆粒細胞の様々な時系列発火パターンを生成し、これを過完備な基底として用いる。平行線維--プルキンエ細胞間シナプス
のLTD/LTPと組み合わせることで、エアパフ刺激のタイミングで活動する顆粒細胞集団のシナプス結合だけを弱め、
そのタイミングでプルキンエ細胞への興奮性の入力を止める。顆粒細胞は全部で1,02,400個、ゴルジ細胞は1,024個、
プルキンエ細胞は16個である。多数の顆粒細胞をクラスター化して用いることで、ある程度長時間の時間経過を、試行毎
に毎回同じように表現することが可能になる。

## コンパイル方法
6.3.1項の通り`make`する。テキストでは`make`しただけでは実行はされないが、こちらは実行も同時にされるようにした
(他のコードとの一貫性のため)。もしコンパイルだけしたければ
```
node00:~/snsbook/code/part2/ec$ make main
```
とすればよい。

## 実行方法
テキスト通りに実行すると、`gr.spk.n`, `go.spk.n`, `pc.mbp.n`, `pc.spk.n`が作成される。ここで`n`は試行の番号である。

顆粒細胞のラスタープロットは、テキスト通り`gr.spk.n`を直接表示すれば良い。図6.4が得られる。シミュレーションでは
音刺激はトライアル開始の250ミリ秒後から呈示しているが、図6.4では音刺激の開始が0ミリ秒になるようにシフトしている
ので注意する。ゴルジ細胞、プルキンエ細胞のラスタープロットも、もし見たければ`go.spk.n`, `pc.spk.n`を表示すれば良い。

顆粒細胞のPSTHは、同梱の`psth.rb`を実行すると得られる。`psth.rb`を実行すると、顆粒細胞1から8 (番号は0から7)
の試行毎のスパイクパターンをまとめたファイル`gr.trial.n`と、それに基づいてPSTHを求めたファイル`gr.psth.n`が
生成される。`gr.trial.n`をプロットすると図6.5の上のパネルが得られ、`gr.psth.n`をプロットすると図6.5の下の
パネルが得られる。PSTHのビン幅は、スクリプト内の
```
B = 10 # PSTHのビン幅 (ミリ秒)
```
で設定できる。gnuplotでPSTHを表示を表示するときは、`with impulses` (あるいは短縮して`w i`) として、縦棒で値を
表示すること。

プルキンエ細胞の発火パターンは、テキスト通り`pc.mbp.n`を表示すれば良い。図6.7相当が得られる。ただし、
積分発火型モデルの膜電位をそのまま出力しているので、そのまま表示するとスパイクを示す縦棒は表示され
ないことに注意する。図6.7と同じ出力を得たければ、積分発火型モデル (リスト3.2) のように縦棒を一緒に
出力するようにコードを修正するか、`pc.mbp.n`と`pc.spk.n`からうまく数値を生成するようなスクリプトを
書く必要がある (図6.7は後者によって得た)。
